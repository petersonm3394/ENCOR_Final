---
- name: Configure IP SLA & Object Tracking for HSRP Failover
  hosts: multi_switches
  gather_facts: no

  vars:
    sla_id: 1
    track_id: 1
    sla_target: 21.25.67.69

  tasks:

    - name: Configure IP SLA ICMP echo
      ios_config:
        parents:
          - ip sla {{ sla_id }}
        lines:
          - icmp-echo {{ sla_target }}
          - frequency 5

    - name: Schedule IP SLA
      ios_config:
        lines:
          - ip sla schedule {{ sla_id }} life forever start-time now

    - name: Configure tracking object
      ios_config:
        lines:
          - track {{ track_id }} ip sla {{ sla_id }} reachability

    - name: Apply tracking to HSRP VLAN 67
      ios_config:
        parents:
          - interface Vlan67
        lines:
          - standby 67 track {{ track_id }} decrement 30

    - name: Apply tracking to HSRP VLAN 69
      ios_config:
        parents:
          - interface Vlan69
        lines:
          - standby 69 track {{ track_id }} decrement 30
