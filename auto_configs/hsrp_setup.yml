---
- name: Configure HSRPv2 (IPv4 + IPv6) on Distribution Switches
  hosts: switches
  gather_facts: no

  vars:
    hsrp_vlans:
      - vlan: 67
        vip: 192.168.67.254
      - vlan: 69
        vip: 192.168.69.254

  tasks:

    - name: Skip non-distribution switches
      meta: end_host
      when: inventory_hostname not in ['D1', 'D2']

    - name: Configure HSRPv2 for IPv4 and IPv6
      ios_config:
        parents: "interface Vlan{{ item.vlan }}"
        lines:
          - standby version 2
          - standby {{ item.vlan }} ip {{ item.vip }}
          - standby {{ item.vlan }} ipv6 autoconfig
          - standby {{ item.vlan }} priority {{ priority }}
          - standby {{ item.vlan }} preempt
      loop: "{{ hsrp_vlans }}"
      vars:
        priority: >-
          {% if inventory_hostname == 'D1' and item.vlan == 67 %}110
          {% elif inventory_hostname == 'D2' and item.vlan == 69 %}110
          {% else %}90{% endif %}

    - name: Verify HSRP status
      ios_command:
        commands:
          - show standby brief
      register: hsrp_status

    - name: Display HSRP results
      debug:
        var: hsrp_status.stdout_lines
